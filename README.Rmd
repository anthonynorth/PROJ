---
output: github_document
editor_options: 
  chunk_output_type: console
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)

library(lwgeom)
library(rgdal)
library(reproj)

```
# PROJ

<!-- badges: start -->
<!-- badges: end -->

The goal of PROJ is to provide generic coordinate system transformations. 

## Installation

Too early. 

# Notes


THINGS TO WORRY ABOUT:

* the *name* of this package
* t and z
* threading, see the PJ_CONTEXT
* coordinate order

https://proj4.org/development/quickstart.html

## Example

Minimal code example, two lon-lat coordinates to LAEA, and back. 


```{r minimal}
library(PROJ)
lon <- c(0, 147)
lat <- c(0, -42)
z <- rep(0, length(lon))
dst <- "+proj=laea +datum=WGS84 +lon_0=147 +lat_0=-42"

## forward transformation
(xy <- proj_trans(dst, lon, lat, z, INV = FALSE))

## inverse transformation
proj_trans(dst, xy$X, xy$Y, z, INV = TRUE)


```

A more realistic example with coastline map data. 


```{r example}
library(PROJ)
w <- quadmesh::xymap
lon <- na.omit(w[,1])
lat <- na.omit(w[,2])
dst <- "+proj=laea +datum=WGS84 +lon_0=147 +lat_0=-42"
xyz <- proj_trans(dst, X = lon, Y = lat, Z = rep(0, length(lon)), INV = FALSE)
plot(xyz$X, xyz$Y, pch = ".")

lonlat <- proj_trans(dst, X = xyz$X, Y = xyz$Y, Z = rep(0, length(lon)), INV = TRUE)
plot(lonlat$X, lonlat$Y, pch = ".")
```



# Speed comparisons

```{r speed}
ll <- cbind(lon, lat)
llproj <- "+proj=longlat +datum=WGS84"
stll <- sf::st_crs(llproj)
sfx <- sf::st_sfc(sf::st_multipoint(ll), crs = stll)  
rbenchmark::benchmark(PROJ = proj_trans(dst, lon, lat, rep(0, length(lon)), FALSE), 
          reproj = reproj(cbind(lon, lat), target = dst, source = llproj), 
          rgdal = project(ll, dst), 
          lwgeom = st_transform_proj(sfx, dst), 
          sf = st_transform(sfx, dst))
```

## Why PROJ?

For many years [PROJ.4](https://proj4.org) has been the name of the common standard library for general coordinate system transformations (for geospatial). That name was given in the 1970s and is now encapsulated by a new modernized version of the library
that probably should be called "PROJ", and now has versions **PROJ 5** and **PROJ 6**. 

There are various links to the PROJ.4 library in R. 

* [rgdal](https://CRAN.R-project.org/package=rgdal)

Please note that the 'PROJ' project is released with a
  [Contributor Code of Conduct](CODE_OF_CONDUCT.md).
  By contributing to this project, you agree to abide by its terms.
